!function(a){var b=null,c={},d=[],e=[],f=a("html"),g=a("body"),h=a(window),i=function(){if(d.length||e.length){var a=d.length?d[d.length-1]:e[e.length-1],j=h.width(),k=h.height(),l=c[a].config.height,m=l,n=c[a].config.width,o=0,p=!1,q=!1;if(b&&f.addClass("has-caldera-modal"),o=(k-c[a].config.height)/2.2,o<0&&(o=0),l+2*c[a].config.padding>k&&b&&(l=k-2*c[a].config.padding,m="100%",b&&b.css({paddingTop:c[a].config.padding,paddingBottom:c[a].config.padding}),q=!0),n+2*c[a].config.padding>=j&&(n="100%",b&&b.css({paddingLeft:c[a].config.padding,paddingRight:c[a].config.padding}),q=!0),!0===q&&(j<=700&&j>600?(b&&(l=k-2*c[a].config.padding),n=j,m=l-2*c[a].config.padding,n="100%",o=0,b&&b.css({padding:c[a].config.padding})):j<=600&&(b&&(l=k),n=j,m="100%",o=0,b&&b.css({padding:0}))),b&&b.is(":hidden")&&(p=!0,b.show()),c[a].header&&(b&&b.show(),l-=c[a].header.outerHeight(),c[a].closer.css({padding:c[a].header.outerHeight()/2-.5}),c[a].title.css({paddingRight:c[a].closer.outerWidth()})),c[a].footer&&(b&&b.show(),l-=c[a].footer.outerHeight()),b&&!0===p&&(b.hide(),p=!1),l!=m&&c[a].body.css({height:l}),c[a].modal.css({width:n}),c[a].config.sticky&&c[a].config.minimized){var r={},s=c[a].title.outerHeight()-c[a].modal.outerHeight();c[a].config.sticky.indexOf("bottom")>-1?r["margin-bottom"]=s:c[a].config.sticky.indexOf("top")>-1&&(r["margin-top"]=s),c[a].modal.css(r),c[a].config.sticky.length>=3&&(g.css("margin-"+c[a].config.sticky[0],c[a].title.outerHeight()),q?c[a].modal.css(c[a].config.sticky[1],0):c[a].modal.css(c[a].config.sticky[1],parseFloat(c[a].config.sticky[2])))}return b&&(c[a].modal.css({marginTop:o,height:m}),setTimeout(function(){c[a].modal.addClass("caldera-animate")},10),b.fadeIn(c[a].config.speed)),c[a].resize=i,c}},j=function(e){var g=a(e).data("modal"),h=0,i={};if(e&&c[g].config.sticky)return c[g].config.minimized?(c[g].config.minimized=!1,h=0):(c[g].config.minimized=!0,h=c[g].title.outerHeight()-c[g].modal.outerHeight()),c[g].config.sticky.indexOf("bottom")>-1?i["margin-bottom"]=h:c[g].config.sticky.indexOf("top")>-1&&(i["margin-top"]=h),void c[g].modal.stop().animate(i,c[g].config.speed);var j;d.length&&(j=d.pop(),c[j].modal.hasClass("caldera-animate")&&!d.length?(c[j].modal.removeClass("caldera-animate"),setTimeout(function(){c[j].modal.remove(),delete c[j]},500)):b&&c[j].modal.hide(0,function(){a(this).remove(),delete c[j]})),d.length?c[d[d.length-1]].modal.show():(b&&b.fadeOut(250,function(){a(this).remove(),b=null}),f.removeClass("has-caldera-modal"))};a.calderaModal=function(f){var h=a.extend(!0,{element:"div",height:550,width:620,padding:12,speed:250},f);b||h.sticky||(b=a("<div>",{class:"caldera-backdrop"}),h.focus||b.on("click",function(a){a.target==this&&j()}),g.append(b),b.hide());var k=h.element,l=h.modal;if(d.length&&d[d.length-1]!==l&&c[d[d.length-1]].modal.hide(),void 0===c[l]?(h.sticky&&(h.sticky=h.sticky.split(" "),h.sticky.length<2&&(h.sticky=null),e.push(l)),c[l]={config:h,modal:a("<"+k+">",{id:l+"_calderaModal",tabIndex:-1,"ariaLabelled-by":l+"_calderaModalLable",class:"caldera-modal-wrap"+(h.sticky?" caldera-sticky-modal "+h.sticky[0]+"-"+h.sticky[1]:"")})},h.sticky||d.push(l)):(c[l].config=h,c[l].modal.empty()),h.animate&&b){var m=h.animate.split(" "),n=h.speed+"ms",o=h.animateEase?h.animateEase:"ease";1===m.length&&(m[1]=0),c[l].modal.css({transform:"translate("+m[0]+", "+m[1]+")","-web-kit-transition":"transform "+n+" "+o,"-moz-transition":"transform "+n+" "+o,transition:"transform "+n+" "+o})}if(c[l].body=a("<div>",{class:"caldera-modal-body",id:l+"_calderaModalBody"}),c[l].content=a("<div>",{class:"caldera-modal-content",id:l+"_calderaModalContent"}),c[l].content.css({margin:h.padding}),c[l].body.append(c[l].content).appendTo(c[l].modal),b?b.append(c[l].modal):c[l].modal.appendTo(a("body")),h.footer)if(c[l].footer=a("<div>",{class:"caldera-modal-footer",id:l+"_calderaModalFooter"}),c[l].footer.css({padding:h.padding}),c[l].footer.appendTo(c[l].modal),"function"==typeof window[h.footer])c[l].footer.append(window[h.footer](f,this));else if("string"==typeof h.footer)try{var p=a(h.footer);c[l].footer.html(p.html())}catch(a){c[l].footer.html(h.footer)}if(h.title){var q="prependTo";c[l].header=a("<div>",{class:"caldera-modal-title",id:l+"_calderaModalTitle"}),c[l].closer=a("<a>",{href:"#close",class:"caldera-modal-closer","data-dismiss":"modal","aria-hidden":"true",id:l+"_calderaModalCloser"}).html("&times;"),c[l].title=a("<h3>",{class:"modal-label",id:l+"_calderaModalLable"}),c[l].title.html(h.title).appendTo(c[l].header),c[l].title.css({padding:h.padding}),c[l].title.append(c[l].closer),c[l].config.sticky?(c[l].config.minimized&&!0!==c[l].config.minimized&&(setTimeout(function(){c[l].title.trigger("click")},parseInt(c[l].config.minimized)),c[l].config.minimized=!1),c[l].closer.hide(),c[l].title.addClass("caldera-modal-closer").data("modal",l).appendTo(c[l].header),c[l].config.sticky.indexOf("top")>-1&&(q="appendTo")):c[l].closer.data("modal",l).appendTo(c[l].header),c[l].header[q](c[l].modal)}if(c[l].modal.outerHeight(h.height),c[l].modal.outerWidth(h.width),h.content)if("function"==typeof h.content)c[l].content.append(h.content(f,c[l],this));else if("function"==typeof window[h.content])c[l].content.append(window[h.content](f,c[l],this));else if("string"==typeof h.content)try{var r=a(h.content);r.length?(c[l].content.append(r.detach()),r.show()):c[l].content.html(h.content)}catch(a){c[l].content.html(h.content)}return i(),c[l]},a.fn.calderaModal=function(b){return b||(b={}),b=a.extend({},this.data(),b),a.calderaModal(b)},window.addEventListener?(window.addEventListener("resize",i,!1),window.addEventListener("keypress",function(a){27===a.keyCode&&null!==b&&b.trigger("click")},!1)):window.attachEvent?window.attachEvent("onresize",i):window.onresize=i,a(document).on("click","[data-modal]:not(.caldera-modal-closer)",function(b){b.preventDefault(),a(this).calderaModal()}),a(window).load(function(){a("[data-modal][data-autoload]").each(function(){a(this).calderaModal()})}),a(document).on("click",".caldera-modal-closer",function(a){a.preventDefault(),j(this)})}(jQuery);