jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target"}},plugins:{},svgPath:null},function(a,b,c,d){"use strict";d.fn.trumbowyg=function(a,b){var c="trumbowyg";if(a===Object(a)||!a)return this.each(function(){d(this).data(c)||d(this).data(c,new e(this,a))});if(1===this.length)try{var f=d(this).data(c);switch(a){case"execCmd":return f.execCmd(b.cmd,b.param,b.forceCss);case"openModal":return f.openModal(b.title,b.content);case"closeModal":return f.closeModal();case"openModalInsert":return f.openModalInsert(b.title,b.fields,b.callback);case"saveRange":return f.saveRange();case"getRange":return f.range;case"getRangeText":return f.getRangeText();case"restoreRange":return f.restoreRange();case"enable":return f.toggleDisable(!1);case"disable":return f.toggleDisable(!0);case"destroy":return f.destroy();case"empty":return f.empty();case"html":return f.html(b)}}catch(a){}return!1};var e=function(a,e){var f=this,g="trumbowyg-icons";f.doc=a.ownerDocument||c,f.$ta=d(a),f.$c=d(a),e=e||{},null!=e.lang||null!=d.trumbowyg.langs[e.lang]?f.lang=d.extend(!0,{},d.trumbowyg.langs.en,d.trumbowyg.langs[e.lang]):f.lang=d.trumbowyg.langs.en;var h=null!=d.trumbowyg.svgPath?d.trumbowyg.svgPath:e.svgPath;if(f.hasSvg=h!==!1,f.svgPath=f.doc.querySelector("base")?b.location.href.split("#")[0]:"",0===d("#"+g,f.doc).length&&h!==!1){if(null==h)try{throw new Error}catch(a){var i=a.stack.split("\n");for(var j in i)if(i[j].match(/http[s]?:\/\//)){h=i[Number(j)].match(/((http[s]?:\/\/.+\/)([^\/]+\.js))(\?.*)?:/)[1].split("/"),h.pop(),h=h.join("/")+"/ui/icons.svg";break}}var k=f.doc.createElement("div");k.id=g,f.doc.body.insertBefore(k,f.doc.body.childNodes[0]),d.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",url:h,data:null,beforeSend:null,complete:null,success:function(a){k.innerHTML=(new XMLSerializer).serializeToString(a.documentElement)}})}var l=f.lang.header,m=function(){return(b.chrome||b.Intl&&Intl.v8BreakIterator)&&"CSS"in b};f.btnsDef={viewHTML:{fn:"toggle"},undo:{isSupported:m,key:"Z"},redo:{isSupported:m,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:l+" 1"},h2:{fn:"formatBlock",title:l+" 2"},h3:{fn:"formatBlock",title:l+" 3"},h4:{fn:"formatBlock",title:l+" 4"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},f.o=d.extend(!0,{},{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],btnsGrps:{design:["bold","italic","underline","strikethrough"],semantic:["strong","em","del"],justify:["justifyLeft","justifyCenter","justifyRight","justifyFull"],lists:["unorderedList","orderedList"]},btns:[["viewHTML"],["undo","redo"],["formatting"],"btnGrp-semantic",["superscript","subscript"],["link"],["insertImage"],"btnGrp-justify","btnGrp-lists",["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],imgDblClickHandler:function(){var a=d(this),b=a.attr("src"),c="(Base64)";return 0===b.indexOf("data:image")&&(b=c),f.openModalInsert(f.lang.insertImage,{url:{label:"URL",value:b,required:!0},alt:{label:f.lang.description,value:a.attr("alt")}},function(b){return b.src!==c&&a.attr({src:b.src}),a.attr({alt:b.alt}),!0}),!1},plugins:{}},e),f.disabled=f.o.disabled||"TEXTAREA"===a.nodeName&&a.disabled,e.btns?f.o.btns=e.btns:f.o.semantic||(f.o.btns[4]="btnGrp-design"),d.each(f.o.btnsDef,function(a,b){f.addBtnDef(a,b)}),f.keys=[],f.tagToButton={},f.tagHandlers=[],f.pasteHandlers=[].concat(f.o.pasteHandlers),f.init()};e.prototype={init:function(){var a=this;a.height=a.$ta.height(),a.initPlugins();try{a.doc.execCommand("enableObjectResizing",!1,!1)}catch(a){}a.doc.execCommand("defaultParagraphSeparator",!1,"p"),a.buildEditor(),a.buildBtnPane(),a.fixedBtnPaneEvents(),a.buildOverlay(),setTimeout(function(){a.disabled&&a.toggleDisable(!0),a.$c.trigger("tbwinit")})},addBtnDef:function(a,b){this.btnsDef[a]=b},buildEditor:function(){var a=this,c=a.o.prefix,e="";a.$box=d("<div/>",{class:c+"box "+c+"editor-visible "+c+a.o.lang+" trumbowyg"}),a.isTextarea=a.$ta.is("textarea"),a.isTextarea?(e=a.$ta.val(),a.$ed=d("<div/>"),a.$box.insertAfter(a.$ta).append(a.$ed,a.$ta)):(a.$ed=a.$ta,e=a.$ed.html(),a.$ta=d("<textarea/>",{name:a.$ta.attr("id"),height:a.height}).val(e),a.$box.insertAfter(a.$ed).append(a.$ta,a.$ed),a.syncCode()),a.$ta.addClass(c+"textarea").attr("tabindex",-1),a.$ed.addClass(c+"editor").attr({contenteditable:!0,dir:a.lang._dir||"ltr"}).html(e),a.o.tabindex&&a.$ed.attr("tabindex",a.o.tabindex),a.$c.is("[placeholder]")&&a.$ed.attr("placeholder",a.$c.attr("placeholder")),a.o.resetCss&&a.$ed.addClass(c+"reset-css"),a.o.autogrow||a.$ta.add(a.$ed).css({height:a.height}),a.semanticCode();var h,f=!1,g=!1;a.$ed.on("dblclick","img",a.o.imgDblClickHandler).on("keydown",function(b){if(g=229===b.which,b.ctrlKey){f=!0;var c=a.keys[String.fromCharCode(b.which).toUpperCase()];try{return a.execCmd(c.fn,c.param),!1}catch(a){}}}).on("keyup input",function(b){b.which>=37&&b.which<=40||(!b.ctrlKey||89!==b.which&&90!==b.which?f||17===b.which||g||(a.semanticCode(!1,13===b.which),a.$c.trigger("tbwchange")):a.$c.trigger("tbwchange"),setTimeout(function(){f=!1},200))}).on("mouseup keydown keyup",function(){clearTimeout(h),h=setTimeout(function(){a.updateButtonPaneStatus()},50)}).on("focus blur",function(b){a.$c.trigger("tbw"+b.type),"blur"===b.type&&d("."+c+"active-button",a.$btnPane).removeClass(c+"active-button "+c+"active")}).on("cut",function(){setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwchange")},0)}).on("paste",function(c){if(a.o.removeformatPasted){c.preventDefault();try{var e=b.clipboardData.getData("Text");try{a.doc.selection.createRange().pasteHTML(e)}catch(b){a.doc.getSelection().getRangeAt(0).insertNode(a.doc.createTextNode(e))}}catch(b){a.execCmd("insertText",(c.originalEvent||c).clipboardData.getData("text/plain"))}}d.each(a.pasteHandlers,function(a,b){b(c)}),setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwpaste",c)},0)}),a.$ta.on("keyup paste",function(){a.$c.trigger("tbwchange")}),a.$box.on("keydown",function(b){if(27===b.which&&1===d("."+c+"modal-box",a.$box).length)return a.closeModal(),!1})},buildBtnPane:function(){var a=this,b=a.o.prefix,c=a.$btnPane=d("<div/>",{class:b+"button-pane"});d.each(a.o.btns,function(e,f){try{var g=f.split("btnGrp-");null!=g[1]&&(f=a.o.btnsGrps[g[1]])}catch(a){}d.isArray(f)||(f=[f]);var h=d("<div/>",{class:b+"button-group "+(f.indexOf("fullscreen")>=0?b+"right":"")});d.each(f,function(b,c){try{var d;a.isSupportedBtn(c)&&(d=a.buildBtn(c)),h.append(d)}catch(a){}}),c.append(h)}),a.$box.prepend(c)},buildBtn:function(a){var b=this,c=b.o.prefix,e=b.btnsDef[a],f=e.dropdown,g=null==e.hasIcon||e.hasIcon,h=b.lang[a]||a,i=d("<button/>",{type:"button",class:c+a+"-button "+(e.class||"")+(g?"":" "+c+"textual-button"),html:b.hasSvg&&g?'<svg><use xlink:href="'+b.svgPath+"#"+c+(e.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':e.text||e.title||b.lang[a]||a,title:(e.title||e.text||h)+(e.key?" (Ctrl + "+e.key+")":""),tabindex:-1,mousedown:function(){return f&&!d("."+a+"-"+c+"dropdown",b.$box).is(":hidden")||d("body",b.doc).trigger("mousedown"),!(b.$btnPane.hasClass(c+"disable")&&!d(this).hasClass(c+"active")&&!d(this).hasClass(c+"not-disable"))&&(b.execCmd(!!f&&"dropdown"||e.fn||a,e.param||a,e.forceCss||!1),!1)}});if(f){i.addClass(c+"open-dropdown");var j=c+"dropdown",k=d("<div/>",{class:j+"-"+a+" "+j+" "+c+"fixed-top","data-dropdown":a});d.each(f,function(a,c){b.btnsDef[c]&&b.isSupportedBtn(c)&&k.append(b.buildSubBtn(c))}),b.$box.append(k.hide())}else e.key&&(b.keys[e.key]={fn:e.fn||a,param:e.param||a});return f||(b.tagToButton[(e.tag||a).toLowerCase()]=a),i},buildSubBtn:function(a){var b=this,c=b.o.prefix,e=b.btnsDef[a],f=null==e.hasIcon||e.hasIcon;return e.key&&(b.keys[e.key]={fn:e.fn||a,param:e.param||a}),b.tagToButton[(e.tag||a).toLowerCase()]=a,d("<button/>",{type:"button",class:c+a+"-dropdown-button"+(e.ico?" "+c+e.ico+"-button":""),html:b.hasSvg&&f?'<svg><use xlink:href="'+b.svgPath+"#"+c+(e.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(e.text||e.title||b.lang[a]||a):e.text||e.title||b.lang[a]||a,title:e.key?" (Ctrl + "+e.key+")":null,style:e.style||null,mousedown:function(){return d("body",b.doc).trigger("mousedown"),b.execCmd(e.fn||a,e.param||a,e.forceCss||!1),!1}})},isSupportedBtn:function(a){try{return this.btnsDef[a].isSupported()}catch(a){}return!0},buildOverlay:function(){var a=this;return a.$overlay=d("<div/>",{class:a.o.prefix+"overlay"}).css({top:a.$btnPane.outerHeight(),height:a.$ed.outerHeight()+1+"px"}).appendTo(a.$box),a.$overlay},showOverlay:function(){var a=this;d(b).trigger("scroll"),a.$overlay.fadeIn(200),a.$box.addClass(a.o.prefix+"box-blur")},hideOverlay:function(){var a=this;a.$overlay.fadeOut(50),a.$box.removeClass(a.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var a=this,c=a.o.fixedFullWidth,e=a.$box;a.o.fixedBtnPane&&(a.isFixed=!1,d(b).on("scroll resize",function(){if(e){a.syncCode();var f=d(b).scrollTop(),g=e.offset().top+1,h=a.$btnPane,i=h.outerHeight()-2;f-g>0&&f-g-a.height<0?(a.isFixed||(a.isFixed=!0,h.css({position:"fixed",top:0,left:c?"0":"auto",zIndex:7}),d([a.$ta,a.$ed]).css({marginTop:h.height()})),h.css({width:c?"100%":e.width()-1+"px"}),d("."+a.o.prefix+"fixed-top",e).css({position:c?"fixed":"absolute",top:c?i:i+(f-g)+"px",zIndex:15})):a.isFixed&&(a.isFixed=!1,h.removeAttr("style"),d([a.$ta,a.$ed]).css({marginTop:0}),d("."+a.o.prefix+"fixed-top",e).css({position:"absolute",top:i}))}}))},toggleDisable:function(a){var b=this,c=b.o.prefix;b.disabled=a,a?b.$ta.attr("disabled",!0):b.$ta.removeAttr("disabled"),b.$box.toggleClass(c+"disabled",a),b.$ed.attr("contenteditable",!a)},destroy:function(){var a=this,b=a.o.prefix,c=a.height;a.isTextarea?a.$box.after(a.$ta.css({height:c}).val(a.html()).removeClass(b+"textarea").show()):a.$box.after(a.$ed.css({height:c}).removeClass(b+"editor").removeAttr("contenteditable").html(a.html()).show()),a.$ed.off("dblclick","img"),a.destroyPlugins(),a.$box.remove(),a.$c.removeData("trumbowyg"),d("body").removeClass(b+"body-fullscreen"),a.$c.trigger("tbwclose")},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var a=this,b=a.o.prefix;a.semanticCode(!1,!0),setTimeout(function(){a.doc.activeElement.blur(),a.$box.toggleClass(b+"editor-hidden "+b+"editor-visible"),a.$btnPane.toggleClass(b+"disable"),d("."+b+"viewHTML-button",a.$btnPane).toggleClass(b+"active"),a.$box.hasClass(b+"editor-visible")?a.$ta.attr("tabindex",-1):a.$ta.removeAttr("tabindex")},0)},dropdown:function(a){var c=this,e=c.doc,f=c.o.prefix,g=d("[data-dropdown="+a+"]",c.$box),h=d("."+f+a+"-button",c.$btnPane),i=g.is(":hidden");if(d("body",e).trigger("mousedown"),i){var j=h.offset().left;h.addClass(f+"active"),g.css({position:"absolute",top:h.offset().top-c.$btnPane.offset().top+h.outerHeight(),left:c.o.fixedFullWidth&&c.isFixed?j+"px":j-c.$btnPane.offset().left+"px"}).show(),d(b).trigger("scroll"),d("body",e).on("mousedown",function(){d("."+f+"dropdown",e).hide(),d("."+f+"active",e).removeClass(f+"active"),d("body",e).off("mousedown")})}},html:function(a){var b=this;return null!=a?(b.$ta.val(a),b.syncCode(!0),b):b.$ta.val()},syncTextarea:function(){var a=this;a.$ta.val(a.$ed.text().trim().length>0||a.$ed.find("hr,img,embed,iframe,input").length>0?a.$ed.html():"")},syncCode:function(a){var b=this;!a&&b.$ed.is(":visible")?b.syncTextarea():b.$ed.html(b.$ta.val()),b.o.autogrow&&(b.height=b.$ed.height(),b.height!==b.$ta.css("height")&&(b.$ta.css({height:b.height}),b.$c.trigger("tbwresize")))},semanticCode:function(a,b){var c=this;if(c.saveRange(),c.syncCode(a),d(c.o.tagsToRemove.join(","),c.$ed).remove(),c.o.semantic){if(c.semanticTag("b","strong"),c.semanticTag("i","em"),b){var e=c.o.inlineElementsSelector,f=":not("+e+")";c.$ed.contents().filter(function(){return 3===this.nodeType&&this.nodeValue.trim().length>0}).wrap("<span data-tbw/>");var g=function(a){if(0!==a.length){var b=a.nextUntil(f).addBack().wrapAll("<p/>").parent(),c=b.nextAll(e).first();b.next("br").remove(),g(c)}};g(c.$ed.children(e).first()),c.semanticTag("div","p",!0),c.$ed.find("p").filter(function(){return(!c.range||this!==c.range.startContainer)&&(0===d(this).text().trim().length&&0===d(this).children().not("br,span").length)}).contents().unwrap(),d("[data-tbw]",c.$ed).contents().unwrap(),c.$ed.find("p:empty").remove()}c.restoreRange(),c.syncTextarea()}},semanticTag:function(a,b,c){d(a,this.$ed).each(function(){var a=d(this);a.wrap("<"+b+"/>"),c&&d.each(a.prop("attributes"),function(){a.parent().attr(this.name,this.value)}),a.contents().unwrap()})},createLink:function(){for(var e,f,g,a=this,b=a.doc.getSelection(),c=b.focusNode;["A","DIV"].indexOf(c.nodeName)<0;)c=c.parentNode;if(c&&"A"===c.nodeName){var h=d(c);e=h.attr("href"),f=h.attr("title"),g=h.attr("target");var i=a.doc.createRange();i.selectNode(c),b.addRange(i)}a.saveRange(),a.openModalInsert(a.lang.createLink,{url:{label:"URL",required:!0,value:e},title:{label:a.lang.title,value:f},text:{label:a.lang.text,value:a.getRangeText()},target:{label:a.lang.target,value:g}},function(b){var c=d(['<a href="',b.url,'">',b.text,"</a>"].join(""));return b.title.length>0&&c.attr("title",b.title),b.target.length>0&&c.attr("target",b.target),a.range.deleteContents(),a.range.insertNode(c[0]),!0})},unlink:function(){var a=this,b=a.doc.getSelection(),c=b.focusNode;if(b.isCollapsed){for(;["A","DIV"].indexOf(c.nodeName)<0;)c=c.parentNode;if(c&&"A"===c.nodeName){var d=a.doc.createRange();d.selectNode(c),b.addRange(d)}}a.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var a=this;a.saveRange(),a.openModalInsert(a.lang.insertImage,{url:{label:"URL",required:!0},alt:{label:a.lang.description,value:a.getRangeText()}},function(b){return a.execCmd("insertImage",b.url),d('img[src="'+b.url+'"]:not([alt])',a.$box).attr("alt",b.alt),!0})},fullscreen:function(){var f,a=this,c=a.o.prefix,e=c+"fullscreen";a.$box.toggleClass(e),f=a.$box.hasClass(e),d("body").toggleClass(c+"body-fullscreen",f),d(b).trigger("scroll"),a.$c.trigger("tbw"+(f?"open":"close")+"fullscreen")},execCmd:function(b,c,d,e){var f=this;e=!!e||"","dropdown"!==b&&f.$ed.focus();try{f.doc.execCommand("styleWithCSS",!1,d||!1)}catch(a){}try{f[b+e](c)}catch(d){try{b(c)}catch(d){"insertHorizontalRule"===b?c=void 0:"formatBlock"!==b||a.userAgent.indexOf("MSIE")===-1&&a.appVersion.indexOf("Trident/")===-1||(c="<"+c+">"),f.doc.execCommand(b,!1,c),f.syncCode(),f.semanticCode(!1,!0)}"dropdown"!==b&&(f.updateButtonPaneStatus(),f.$c.trigger("tbwchange"))}},openModal:function(a,c){var e=this,f=e.o.prefix;if(d("."+f+"modal-box",e.$box).length>0)return!1;e.saveRange(),e.showOverlay(),e.$btnPane.addClass(f+"disable");var g=d("<div/>",{class:f+"modal "+f+"fixed-top"}).css({top:e.$btnPane.height()}).appendTo(e.$box);e.$overlay.one("click",function(){return g.trigger("tbwcancel"),!1});var h=d("<form/>",{action:"",html:c}).on("submit",function(){return g.trigger("tbwconfirm"),!1}).on("reset",function(){return g.trigger("tbwcancel"),!1}),i=d("<div/>",{class:f+"modal-box",html:h}).css({top:"-"+e.$btnPane.outerHeight()+"px",opacity:0}).appendTo(g).animate({top:0,opacity:1},100);return d("<span/>",{text:a,class:f+"modal-title"}).prependTo(i),g.height(i.outerHeight()+10),d("input:first",i).focus(),e.buildModalBtn("submit",i),e.buildModalBtn("reset",i),d(b).trigger("scroll"),g},buildModalBtn:function(a,b){var c=this,e=c.o.prefix;return d("<button/>",{class:e+"modal-button "+e+"modal-"+a,type:a,text:c.lang[a]||a}).appendTo(d("form",b))},closeModal:function(){var a=this,b=a.o.prefix;a.$btnPane.removeClass(b+"disable"),a.$overlay.off();var c=d("."+b+"modal-box",a.$box);c.animate({top:"-"+c.height()},100,function(){c.parent().remove(),a.hideOverlay()}),a.restoreRange()},openModalInsert:function(a,b,c){var e=this,f=e.o.prefix,g=e.lang,h="",i="tbwconfirm";return d.each(b,function(a,b){var c=b.label,d=b.name||a,e=b.attributes||{},i=Object.keys(e).map(function(a){return a+'="'+e[a]+'"'}).join(" ");h+='<label><input type="'+(b.type||"text")+'" name="'+d+'" value="'+(b.value||"").replace(/"/g,"&quot;")+'"'+i+'><span class="'+f+'input-infos"><span>'+(c?g[c]?g[c]:c:g[a]?g[a]:a)+"</span></span></label>"}),e.openModal(a,h).on(i,function(){var a=d("form",d(this)),f=!0,g={};d.each(b,function(b,c){var h=d('input[name="'+b+'"]',a),i=h.attr("type");"checkbox"===i.toLowerCase()?g[b]=h.is(":checked"):g[b]=d.trim(h.val()),c.required&&""===g[b]?(f=!1,e.addErrorOnModalField(h,e.lang.required)):c.pattern&&!c.pattern.test(g[b])&&(f=!1,e.addErrorOnModalField(h,c.patternError))}),f&&(e.restoreRange(),c(g,b)&&(e.syncCode(),e.$c.trigger("tbwchange"),e.closeModal(),d(this).off(i)))}).one("tbwcancel",function(){d(this).off(i),e.closeModal()})},addErrorOnModalField:function(a,b){var c=this.o.prefix,e=a.parent();a.on("change keyup",function(){e.removeClass(c+"input-error")}),e.addClass(c+"input-error").find("input+span").append(d("<span/>",{class:c+"msg-error",text:b}))},saveRange:function(){var a=this,b=a.doc.getSelection();if(a.range=null,b.rangeCount){var e,c=a.range=b.getRangeAt(0),d=a.doc.createRange();d.selectNodeContents(a.$ed[0]),d.setEnd(c.startContainer,c.startOffset),e=(d+"").length,a.metaRange={start:e,end:e+(c+"").length}}},restoreRange:function(){var e,a=this,b=a.metaRange,c=a.range,d=a.doc.getSelection();if(c){if(b&&b.start!==b.end){var h,f=0,g=[a.$ed[0]],i=!1,j=!1;for(e=a.doc.createRange();!j&&(h=g.pop());)if(3===h.nodeType){var k=f+h.length;!i&&b.start>=f&&b.start<=k&&(e.setStart(h,b.start-f),i=!0),i&&b.end>=f&&b.end<=k&&(e.setEnd(h,b.end-f),j=!0),f=k}else for(var l=h.childNodes,m=l.length;m>0;)m-=1,g.push(l[m])}d.removeAllRanges(),d.addRange(e||c)}},getRangeText:function(){return this.range+""},updateButtonPaneStatus:function(){var a=this,b=a.o.prefix,c=a.getTagsRecursive(a.doc.getSelection().focusNode),e=b+"active-button "+b+"active";d("."+b+"active-button",a.$btnPane).removeClass(e),d.each(c,function(c,f){var g=a.tagToButton[f.toLowerCase()],h=d("."+b+g+"-button",a.$btnPane);if(h.length>0)h.addClass(e);else try{h=d("."+b+"dropdown ."+b+g+"-dropdown-button",a.$box);var i=h.parent().data("dropdown");d("."+b+i+"-button",a.$box).addClass(e)}catch(a){}})},getTagsRecursive:function(a,b){var c=this;if(b=b||[],!a)return b;a=a.parentNode;var e=a.tagName;return"DIV"===e?b:("P"===e&&""!==a.style.textAlign&&b.push(a.style.textAlign),d.each(c.tagHandlers,function(d,e){b=b.concat(e(a,c))}),b.push(e),c.getTagsRecursive(a,b))},initPlugins:function(){var a=this;a.loadedPlugins=[],d.each(d.trumbowyg.plugins,function(b,c){c.shouldInit&&!c.shouldInit(a)||(c.init(a),c.tagHandler&&a.tagHandlers.push(c.tagHandler),a.loadedPlugins.push(c))})},destroyPlugins:function(){d.each(this.loadedPlugins,function(a,b){b.destroy&&b.destroy()})}}}(navigator,window,document,jQuery);